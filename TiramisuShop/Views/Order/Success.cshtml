@model long
@{
    ViewData["Title"] = "Đặt hàng thành công";
}

@section Links {
    <link rel="stylesheet" href="~/css/order-success.css">
    <link href="https://fonts.googleapis.com/css2?family=Allura&family=Kanit:wght@300;400;500;600&family=Pacifico&display=swap" rel="stylesheet">
}

<section id="content" style="background: #FCF5EF;">
    <div class="success-section mt-5">
        <div class="container">
            <div class="success-card fade-up">

                <div class="success-icon">
                    <i class="fa-solid fa-circle-check"></i>
                </div>

                <h1 class="success-title">Đặt hàng thành công!</h1>

                <p class="success-message">
                    Cảm ơn bạn đã tin tưởng và lựa chọn <b>Cheese Cheese</b>.<br>
                    Đơn hàng của bạn đang được xử lý và sẽ sớm được giao đến.
                </p>

                <div class="order-info-box">
                    <span>Mã đơn hàng:</span>
                    <strong class="order-id">#@Model</strong>
                </div>

                <p class="contact-note">
                    Mọi thắc mắc vui lòng liên hệ hotline <b>0909 123 456</b> để được hỗ trợ.
                </p>

                <div class="action-buttons">
                    <a href="/" class="btn-home"><i class="fa-solid fa-house"></i> Về trang chủ</a>
                    <a href="/Product" class="btn-continue">Tiếp tục mua sắm <i class="fa-solid fa-arrow-right"></i></a>
                </div>

            </div>
        </div>
    </div>

</section>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        
        // Animation Text
        document.addEventListener("DOMContentLoaded", function() {

            // Scroll Animation
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry) => { if (entry.isIntersecting) entry.target.classList.add('active'); });
            }, { threshold: 0.1 });
            document.querySelectorAll('.fade-up').forEach((el) => observer.observe(el));
            runFireworks();
            playSuccessSound();
        });
        function playSuccessSound() {
            var audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3');
            audio.volume = 0.5;

            // Thử phát ngay lập tức
            var promise = audio.play();

            if (promise !== undefined) {
                promise.catch(error => {
                    console.log("Autoplay bị chặn. Đang chờ tương tác người dùng...");

                    // NẾU BỊ CHẶN: Tạo một sự kiện chờ người dùng click bất kỳ đâu vào trang web
                    var playOnInteraction = function() {
                        audio.play();
                        // Sau khi phát xong thì gỡ bỏ sự kiện để không bị lặp lại
                        document.removeEventListener('click', playOnInteraction);
                        document.removeEventListener('touchstart', playOnInteraction);
                        document.removeEventListener('keydown', playOnInteraction);
                    };

                    // Lắng nghe tương tác đầu tiên (Click chuột, Chạm màn hình, Gõ phím)
                    document.addEventListener('click', playOnInteraction);
                    document.addEventListener('touchstart', playOnInteraction);
                    document.addEventListener('keydown', playOnInteraction);
                });
            }
        }

        // 2. Hàm pháo hoa (Giữ nguyên)
        function runFireworks() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };

            function randomInRange(min, max) { return Math.random() * (max - min) + min; }

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) { return clearInterval(interval); }
                var particleCount = 50 * (timeLeft / duration);

                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
                    colors: ['#4B3022', '#FFD700', '#FCF5EF']
                }));
                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
                    colors: ['#4B3022', '#FFD700', '#ff6b81']
                }));
            }, 250);
        }
    </script>
}