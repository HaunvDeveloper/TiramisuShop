@using System.Globalization
@using System.Security.Claims

@{
    var currentController = ViewContext.RouteData.Values["controller"].ToString();
    var currentAction = ViewContext.RouteData.Values["action"].ToString();
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Tiramisu</title>
    <meta name="keywords" content="" />
    <meta name="author" content="Công Ty Cổ Phần Goods Link">
    <meta name="copyright" content="Công Ty Cổ Phần Goods Link [nancy@goli.com.vn]">
    <link rel="icon" href="~/assets/images/logomini.png">
    <link rel="stylesheet" href="~/lib/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" href="~/css/site.css">
    <link rel="stylesheet" href="~/css/font.css">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/lib/sweetalert2/sweetalert2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&family=Allura&family=Arima:wght@100..700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Pacifico&display=swap" rel="stylesheet">



    @await RenderSectionAsync("Links", required: false)
</head>

<body>
    <div id="app">
        <header id="header">
            <div class="container">
                <div class="header-left">
                    <div class="menu-area">
                        <div class="menu-bar">
                            <div class="menu-icon">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                        <nav class="menu">
                            <ol>
                                <li class="menu-item @(currentController == "Home" && currentAction == "Index" ? "active" : "")"><a asp-action="Index" asp-controller="Home">Home</a></li>
                                <li class="menu-item @(currentController == "Home" && currentAction == "About" ? "active" : "")"><a asp-action="About" asp-controller="Home">About us</a></li>
                                <li class="menu-item @(currentController == "Product" ? "active" : "")">
                                    <a asp-action="Index" asp-controller="Product">
                                        Menu
                                    </a>
                                    <img class="angle" src="~/assets/icons/angle.svg" />
                                    <ol class="sub-menu">
                                        
                                    </ol>
                                </li>
                                <li class="menu-item @(currentController == "Event" ? "active" : "")"><a asp-action="Index" asp-controller="Event">Events</a></li>
                                <li class="menu-item @(currentController == "Contact" && currentAction == "Index" ? "active" : "")">
                                    <a asp-action="Index" asp-controller="Contact">Contact</a>
                                </li>
                                
                            </ol>

                        </nav>
                    </div>




                </div>

                <div class="header-right">
                    <a href="@Url.Action("Index", "Cart")" class="header-cart-btn">
                        <img src="~/assets/images/cart-shopping-solid-full.svg" alt="Cart">
                        @* <span class="cart-badge">0</span> *@
                    </a>
                    @if (User.Identity?.IsAuthenticated ?? false)
                    {
                        // Lấy tên hiển thị ngắn gọn
                        var fullName = User.FindFirst("FullName")?.Value ?? User.Identity.Name;
                        // Lấy chữ cái đầu để làm Avatar giả
                        var firstLetter = !string.IsNullOrEmpty(fullName) ? fullName.Substring(0, 1).ToUpper() : "U";

                        <div class="user-account-wrapper">
                            <div class="user-trigger" onclick="toggleUserMenu()">
                                <div class="user-avatar-circle">@firstLetter</div>
                                <span class="user-name-label">@fullName</span>
                                <i class="fa-solid fa-caret-down ms-1" style="font-size: 0.8rem;"></i>
                            </div>

                            <div class="user-dropdown-menu" id="userDropdown">
                                <div class="dropdown-header">
                                    <p class="mb-0">Xin chào,</p>
                                    <strong>@fullName</strong>
                                </div>
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item"><i class="fa-regular fa-user"></i> Hồ sơ của tôi</a>
                                <a href="#" class="dropdown-item"><i class="fa-solid fa-list-check"></i> Đơn mua</a>
                                <div class="dropdown-divider"></div>
                                <a asp-controller="User" asp-action="Logout" class="dropdown-item text-danger">
                                    <i class="fa-solid fa-arrow-right-from-bracket"></i> Đăng xuất
                                </a>
                            </div>
                        </div>
                    }
                    else
                    {
                        <a href="@Url.Action("Login", "User")" class="login-btn-link">
                            <i class="fa-regular fa-user"></i> <span>Đăng nhập</span>
                        </a>
                    }

                    

                </div>
            </div>
        </header>
        <main id="main">
            @RenderBody()
        </main>
        <footer id="footer">
            <div class="mainfooter">
                <div class="px-md-5 mx-md-5 container row">
                    <div class="col-md-5 d-block">
                        <div class="mb-4">
                            <div class="logo">
                                <img src="~/assets/images/logomini.png" alt="Golifresh Logo">
                                <h1>Cheese Cheese</h1>
                            </div>
                            <p>Chill cùng tiramisu chuẩn vị.</p>
                        </div>
                        <div class="mb-4">
                            <h1>Thông tin liên hệ</h1>
                            <p>Địa chỉ: 280, An Dương Vương, phường Chợ Quán, TP.HCM</p>
                            <p>Hotline: 0944746748</p>
                        </div>
                    </div>
                    <div class="col-md-5 d-block">
                        <div class="mb-4">
                                <h1>Mạng xã hội</h1>
                            <div class="d-flex gap-4 align-items-center">
                                <a href="https://www.facebook.com/haunv1003/" class="social-media">
                                    <img src="~/assets/icons/facebook.png" alt="">
                                </a>
                                <a href="https://www.youtube.com/@@CodecungHeovaMeo-oh9nl" class="social-media">
                                    <img src="~/assets/icons/youtube.png" alt="">
                                </a>
                                <a href="https://zalo.me/84944746748" class="social-media">
                                    <img src="~/assets/icons/zalo.png" alt="Zalo" />
                                </a>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>

            <div class="endfooter">
                <div class="container">
                    © 2025 All rights reserved - Designed and developed by HMCoding.
                </div>
            </div>
        </footer>
    </div>




    <script src="~/lib/swiper/swiper-bundle.min.js"></script>
    <script src="~/lib/scrollreveal.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/lib/sweetalert2/sweetalert2.min.js"></script>
    <script>
        $(".btnSubscribe").on('click', function () {
            var ob = {
                Email: $("#email-subs").val()
            }
            $.ajax({
                url: '@Url.Action("Subscribe", "Contact")',
                method: 'post',
                data: ob,
                success: function (res) {
                    if (res.status) {
                        Swal.fire({
                            icon: "success",
                            title: "Đăng ký thành công",
                            showConfirmButton: false,
                            timer: 1500
                        });
                    }
                    else{
                        Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: result.mess,
                            showConfirmButton: false,
                            timer: 1000
                        });
                    }
                }
            });
        });
    </script>

    <script>
        document.querySelector(".menu-bar").addEventListener('click', function () {
            document.querySelector(".menu").classList.toggle("active");
            document.querySelector(".menu-icon").classList.toggle("active");
        });


        $(document).ready(function () {
            let span = $(".lang__active").find("span").html();
            $(".language_navtitle").find("span").html(span);
        });


        $(".menu-item").on('click', function () {
            $(this).toggleClass("active");
        });

       

        $(document).on('scroll ready DOMContentLoaded', function () {
            var header = document.getElementById('header');
            if (window.scrollY > header.offsetHeight) {
                header.classList.add('scroll');
            } else {
                header.classList.remove('scroll');
            }


            var elements = document.querySelectorAll('.scroll-animate,.scroll-animate-bottom,.scroll-animate-d2');
            elements.forEach(function (element) {
                var position = element.getBoundingClientRect();
                if (position.top < window.innerHeight && position.bottom >= 0) {
                    element.classList.add('scroll-animate-succeed');
                }
            });
        });
    </script>
    <script>
        // Hàm bật tắt menu
        function toggleUserMenu() {
            var menu = document.getElementById("userDropdown");
            menu.classList.toggle("show");
        }

        // Sự kiện click ra ngoài để đóng menu
        window.onclick = function(event) {
            // Nếu click không phải vào nút trigger (hoặc con của nó)
            if (!event.target.closest('.user-trigger')) {
                var dropdowns = document.getElementsByClassName("user-dropdown-menu");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
    <script>
        function updateCartBadge() {
                $.get('/Cart/GetCartCount', function (count) {
                    if (count > 0) {
                        // Nếu trong layout bạn chưa có thẻ span .cart-badge thì cần thêm vào
                        // Ví dụ: <span class="cart-badge">0</span> nằm trong nút giỏ hàng ở Header
                        if ($('.cart-badge').length === 0) {
                             $('.header-cart-btn').append('<span class="cart-badge">' + count + '</span>');
                        } else {
                             $('.cart-badge').text(count).show();
                        }
                    }
                });
            }
            // Gọi hàm khi trang được tải
            $(document).ready(function () {
                updateCartBadge();
            });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>

</html>
